# DynamoDB Integration Module - Architecture

**SPARC Phase 3: Architecture**
**Version:** 1.0.0
**Date:** 2025-12-13
**Module:** `integrations/dynamodb`

---

## 1. Module Structure

### 1.1 Directory Layout

```
integrations/dynamodb/
├── Cargo.toml
├── src/
│   ├── lib.rs                    # Public API exports
│   ├── client.rs                 # DynamoDbClient
│   ├── config.rs                 # Configuration types
│   ├── table.rs                  # TableClient
│   ├── auth/
│   │   ├── mod.rs
│   │   ├── credentials.rs        # Static credentials
│   │   ├── role.rs               # IAM role assumption
│   │   └── web_identity.rs       # IRSA/Web identity
│   ├── operations/
│   │   ├── mod.rs
│   │   ├── get.rs                # GetItem
│   │   ├── put.rs                # PutItem
│   │   ├── update.rs             # UpdateItem
│   │   ├── delete.rs             # DeleteItem
│   │   ├── query.rs              # Query operations
│   │   ├── scan.rs               # Scan operations
│   │   ├── batch.rs              # Batch operations
│   │   └── transaction.rs        # Transactions
│   ├── expressions/
│   │   ├── mod.rs
│   │   ├── key_condition.rs      # Key conditions
│   │   ├── filter.rs             # Filter expressions
│   │   ├── update.rs             # Update expressions
│   │   └── condition.rs          # Condition expressions
│   ├── types/
│   │   ├── mod.rs
│   │   ├── key.rs                # Key types
│   │   ├── attribute.rs          # AttributeValue helpers
│   │   └── results.rs            # Result types
│   ├── error.rs                  # Error types
│   ├── retry.rs                  # Retry logic
│   └── simulation/
│       ├── mod.rs
│       ├── mock.rs               # Mock DynamoDB
│       └── recorder.rs           # Record/replay
├── tests/
│   ├── integration/
│   │   ├── crud_test.rs
│   │   ├── query_test.rs
│   │   ├── batch_test.rs
│   │   └── transaction_test.rs
│   └── unit/
│       ├── expression_test.rs
│       ├── key_test.rs
│       └── retry_test.rs
└── typescript/
    ├── package.json
    ├── src/
    │   ├── index.ts
    │   ├── client.ts
    │   ├── table.ts
    │   ├── operations/
    │   └── types/
    └── tests/
```

### 1.2 Module Dependencies

```
┌─────────────────────────────────────────────────────────────┐
│                         dynamodb                             │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  Operations │  │ Expressions │  │    Transactions     │  │
│  │  (CRUD)     │  │  (Builders) │  │    (Multi-item)     │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
│         │                │                     │             │
│         └────────────────┼─────────────────────┘             │
│                          │                                   │
│                   ┌──────▼──────┐                            │
│                   │ TableClient │                            │
│                   └──────┬──────┘                            │
│                          │                                   │
│                   ┌──────▼──────┐                            │
│                   │   Client    │                            │
│                   └──────┬──────┘                            │
│                          │                                   │
│         ┌────────────────┼────────────────┐                  │
│         │                │                │                  │
│  ┌──────▼──────┐  ┌──────▼──────┐  ┌─────▼─────┐            │
│  │    Auth     │  │    Retry    │  │ Simulation│            │
│  │  Provider   │  │    Logic    │  │   Layer   │            │
│  └─────────────┘  └─────────────┘  └───────────┘            │
├─────────────────────────────────────────────────────────────┤
│                      Shared Modules                          │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │Credentials │ │ Resilience │ │Observability│              │
│  └────────────┘ └────────────┘ └────────────┘              │
├─────────────────────────────────────────────────────────────┤
│                       AWS SDK                                │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │aws-sdk-    │ │ aws-config │ │ aws-types  │              │
│  │dynamodb    │ │            │ │            │              │
│  └────────────┘ └────────────┘ └────────────┘              │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. Component Architecture

### 2.1 High-Level Component Diagram

```
┌──────────────────────────────────────────────────────────────────────┐
│                         LLM Dev Ops Platform                          │
└───────────────────────────────┬──────────────────────────────────────┘
                                │
                                ▼
┌──────────────────────────────────────────────────────────────────────┐
│                          DynamoDbClient                               │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │                        Table Layer                              │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │                     TableClient                           │  │  │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │  │
│  │  │  │   CRUD   │ │  Query   │ │   Scan   │ │    Batch    │  │  │  │
│  │  │  │   Ops    │ │   Ops    │ │   Ops    │ │     Ops     │  │  │  │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │                  Transaction Builder                      │  │  │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │  │
│  │  │  │   Put    │ │  Update  │ │  Delete  │ │  Condition  │  │  │  │
│  │  │  │          │ │          │ │          │ │    Check    │  │  │  │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────┘  │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │                     Infrastructure Layer                        │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌──────────┐ │  │
│  │  │    Auth    │  │   Retry    │  │  Circuit   │  │  Metrics │ │  │
│  │  │  Provider  │  │   Logic    │  │  Breaker   │  │          │ │  │
│  │  └────────────┘  └────────────┘  └────────────┘  └──────────┘ │  │
│  └────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────┬──────────────────────────────────┘
                                    │
                                    ▼
┌──────────────────────────────────────────────────────────────────────┐
│                        Amazon DynamoDB                                │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────────────┐  │
│  │   Table A      │  │   Table B      │  │      Global Table      │  │
│  │  ┌──────────┐  │  │  ┌──────────┐  │  │  ┌──────┐  ┌──────┐   │  │
│  │  │   GSI    │  │  │  │   LSI    │  │  │  │  R1  │  │  R2  │   │  │
│  │  └──────────┘  │  │  └──────────┘  │  │  └──────┘  └──────┘   │  │
│  └────────────────┘  └────────────────┘  └────────────────────────┘  │
└──────────────────────────────────────────────────────────────────────┘
```

### 2.2 Request Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                         Request Flow                                 │
└─────────────────────────────────────────────────────────────────────┘

Application                                              DynamoDB
     │                                                       │
     ▼                                                       │
┌─────────────┐                                             │
│ TableClient │                                             │
└──────┬──────┘                                             │
       │                                                     │
       ▼                                                     │
┌─────────────────┐                                         │
│   Build Request │                                         │
│  (expressions)  │                                         │
└────────┬────────┘                                         │
         │                                                   │
         ▼                                                   │
┌─────────────────┐                                         │
│ Circuit Breaker │                                         │
└────────┬────────┘                                         │
         │ check state                                       │
         ▼                                                   │
┌─────────────────┐                                         │
│   Retry Loop    │◄────────────────────┐                   │
└────────┬────────┘                     │                   │
         │                              │ retryable         │
         ▼                              │ error             │
┌─────────────────┐              ┌──────┴──────┐           │
│   AWS SDK       │──────────────│   Error     │           │
│   Request       │              │  Handling   │           │
└────────┬────────┘              └─────────────┘           │
         │                                                  │
         │              HTTPS                               │
         ▼──────────────────────────────────────────────────▼
                                                     ┌─────────────┐
                                                     │  DynamoDB   │
                                                     │   Service   │
                                                     └─────────────┘
```

---

## 3. Data Model Architecture

### 3.1 Key Structure

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Key Structure                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Simple Primary Key (Partition Key only):                            │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  Table: Users                                                   │ │
│  │  ┌──────────────────┐                                          │ │
│  │  │  PK (user_id)    │ ──► Uniquely identifies item             │ │
│  │  │  "USER#123"      │                                          │ │
│  │  └──────────────────┘                                          │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  Composite Primary Key (Partition Key + Sort Key):                   │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  Table: Orders                                                  │ │
│  │  ┌──────────────────┬──────────────────┐                       │ │
│  │  │  PK (user_id)    │  SK (order_id)   │                       │ │
│  │  │  "USER#123"      │  "ORDER#2024001" │ ──► Composite key     │ │
│  │  └──────────────────┴──────────────────┘                       │ │
│  │                                                                 │ │
│  │  Query patterns:                                                │ │
│  │  • PK = "USER#123" ──► All orders for user                     │ │
│  │  • PK = "USER#123" AND SK begins_with "ORDER#2024" ──► 2024    │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Single-Table Design Pattern

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Single-Table Design                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Table: AppData                                                      │
│  ┌──────────────────┬──────────────────┬─────────────────────────┐  │
│  │  PK              │  SK              │  Attributes             │  │
│  ├──────────────────┼──────────────────┼─────────────────────────┤  │
│  │  USER#123        │  PROFILE         │  name, email, ...       │  │
│  │  USER#123        │  ORDER#001       │  total, status, ...     │  │
│  │  USER#123        │  ORDER#002       │  total, status, ...     │  │
│  │  ORDER#001       │  ITEM#A          │  product, qty, ...      │  │
│  │  ORDER#001       │  ITEM#B          │  product, qty, ...      │  │
│  │  PRODUCT#A       │  METADATA        │  name, price, ...       │  │
│  └──────────────────┴──────────────────┴─────────────────────────┘  │
│                                                                      │
│  Access Patterns:                                                    │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  1. Get user profile:     PK=USER#123, SK=PROFILE              │ │
│  │  2. Get user's orders:    PK=USER#123, SK begins_with ORDER#   │ │
│  │  3. Get order items:      PK=ORDER#001, SK begins_with ITEM#   │ │
│  │  4. Get product:          PK=PRODUCT#A, SK=METADATA            │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 GSI Overloading

```
┌─────────────────────────────────────────────────────────────────────┐
│                    GSI Overloading Pattern                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Base Table:                                                         │
│  ┌────────┬──────────┬──────────┬──────────┬────────────────────┐   │
│  │  PK    │  SK      │  GSI1PK  │  GSI1SK  │  Data              │   │
│  ├────────┼──────────┼──────────┼──────────┼────────────────────┤   │
│  │USER#1  │PROFILE   │EMAIL#a@  │USER#1    │ name, email...     │   │
│  │USER#1  │ORDER#001 │STATUS#NEW│TS#2024.. │ total, items...    │   │
│  │USER#2  │ORDER#002 │STATUS#NEW│TS#2024.. │ total, items...    │   │
│  └────────┴──────────┴──────────┴──────────┴────────────────────┘   │
│                                                                      │
│  GSI1 enables:                                                       │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  • Find user by email:  GSI1PK=EMAIL#a@example.com             │ │
│  │  • Find orders by status: GSI1PK=STATUS#NEW, sort by timestamp │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. Operation Flow Architecture

### 4.1 Query Pagination Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Query Pagination Flow                             │
└─────────────────────────────────────────────────────────────────────┘

      Client                    DynamoDB                   Result
        │                          │                          │
        │  Query(PK=X, Limit=10)   │                          │
        │─────────────────────────►│                          │
        │                          │                          │
        │  Items[0-9]              │                          │
        │  LastEvaluatedKey=K1     │                          │
        │◄─────────────────────────│                          │
        │                          │                          │
        │  Query(PK=X,             │                          │
        │    StartKey=K1)          │                          │
        │─────────────────────────►│                          │
        │                          │                          │
        │  Items[10-19]            │                          │
        │  LastEvaluatedKey=K2     │                          │
        │◄─────────────────────────│                          │
        │                          │                          │
        │  Query(PK=X,             │                          │
        │    StartKey=K2)          │                          │
        │─────────────────────────►│                          │
        │                          │                          │
        │  Items[20-25]            │                          │
        │  LastEvaluatedKey=null   │  ◄─── No more pages     │
        │◄─────────────────────────│                          │
        │                          │                          │
        │──────────────────────────┼─────────────────────────►│
        │                          │          All items        │
```

### 4.2 Batch Operation Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Batch Write Flow                                  │
└─────────────────────────────────────────────────────────────────────┘

  Input: 50 items to write (max 25 per request)

       ┌────────────────────────────────────────────────────────┐
       │                    Batch Splitter                       │
       │  ┌─────────────────┐  ┌─────────────────┐              │
       │  │  Chunk 1 (25)   │  │  Chunk 2 (25)   │              │
       │  └────────┬────────┘  └────────┬────────┘              │
       └───────────┼────────────────────┼────────────────────────┘
                   │                    │
                   ▼                    ▼
           ┌─────────────┐      ┌─────────────┐
           │BatchWrite #1│      │BatchWrite #2│
           └──────┬──────┘      └──────┬──────┘
                  │                    │
                  ▼                    ▼
           ┌─────────────┐      ┌─────────────┐
           │ Response    │      │ Response    │
           │ Unproc: 3   │      │ Unproc: 0   │
           └──────┬──────┘      └──────┬──────┘
                  │                    │
                  ▼                    │
           ┌─────────────┐             │
           │  Retry      │             │
           │  (3 items)  │             │
           └──────┬──────┘             │
                  │                    │
                  ▼                    │
           ┌─────────────┐             │
           │ All Done    │◄────────────┘
           └─────────────┘
```

### 4.3 Transaction Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Transaction Write Flow                            │
└─────────────────────────────────────────────────────────────────────┘

  TransactWriteItems (Atomic)

  ┌─────────────────────────────────────────────────────────────────┐
  │  Transaction Bundle                                              │
  │  ┌───────────────┐ ┌───────────────┐ ┌───────────────────────┐  │
  │  │ Put Item A    │ │ Update Item B │ │ ConditionCheck Item C │  │
  │  │ Table: Orders │ │ Table: Users  │ │ Table: Inventory      │  │
  │  └───────┬───────┘ └───────┬───────┘ └───────────┬───────────┘  │
  │          │                 │                     │               │
  │          └─────────────────┼─────────────────────┘               │
  │                            │                                     │
  └────────────────────────────┼─────────────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │    DynamoDB         │
                    │    (All or Nothing) │
                    └──────────┬──────────┘
                               │
              ┌────────────────┼────────────────┐
              │                │                │
              ▼                ▼                ▼
        ┌──────────┐    ┌──────────┐    ┌──────────────┐
        │ Success  │    │ Conflict │    │ Condition    │
        │ (Commit) │    │ (Retry?) │    │ Failed       │
        └──────────┘    └──────────┘    └──────────────┘
```

---

## 5. Retry Architecture

### 5.1 Retry State Machine

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Retry State Machine                               │
└─────────────────────────────────────────────────────────────────────┘

                    ┌───────────────┐
                    │    Start      │
                    └───────┬───────┘
                            │
                            ▼
                    ┌───────────────┐
          ┌────────│   Execute     │────────┐
          │        └───────┬───────┘        │
          │                │                │
       Success          Error            Error
       (done)        (retryable)     (non-retryable)
          │                │                │
          ▼                ▼                ▼
    ┌──────────┐    ┌───────────────┐  ┌──────────┐
    │  Return  │    │ Check Attempt │  │  Return  │
    │  Result  │    │    Count      │  │  Error   │
    └──────────┘    └───────┬───────┘  └──────────┘
                            │
              ┌─────────────┴─────────────┐
              │                           │
         < max attempts             >= max attempts
              │                           │
              ▼                           ▼
       ┌───────────────┐          ┌──────────────┐
       │   Calculate   │          │    Return    │
       │    Backoff    │          │    Error     │
       └───────┬───────┘          └──────────────┘
               │
               ▼
       ┌───────────────┐
       │     Wait      │
       │  (with jitter)│
       └───────┬───────┘
               │
               └─────────► Execute (retry)
```

### 5.2 Backoff Calculation

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Exponential Backoff with Jitter                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Base delay: 50ms (for throttling), 100ms (other errors)            │
│  Max delay: 20 seconds                                               │
│  Jitter: 0-100% of calculated delay                                  │
│                                                                      │
│  Formula: min(base * 2^(attempt-1), max_delay) * (1 + random(0,1))  │
│                                                                      │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  Attempt │ Base Delay │ With Jitter (example)                  │ │
│  │  ────────┼────────────┼─────────────────────────               │ │
│  │    1     │    50ms    │    50-100ms                            │ │
│  │    2     │   100ms    │   100-200ms                            │ │
│  │    3     │   200ms    │   200-400ms                            │ │
│  │    4     │   400ms    │   400-800ms                            │ │
│  │    5     │   800ms    │   800ms-1.6s                           │ │
│  │    6     │   1.6s     │   1.6-3.2s                             │ │
│  │    7     │   3.2s     │   3.2-6.4s                             │ │
│  │    8     │   6.4s     │   6.4-12.8s                            │ │
│  │    9     │  12.8s     │   12.8-20s (capped)                    │ │
│  │   10     │   20s      │   20-40s (capped at max)               │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 6. Error Handling Architecture

### 6.1 Error Classification

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Error Classification                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│                      AWS SDK Error                                   │
│                           │                                          │
│         ┌─────────────────┼─────────────────┐                       │
│         │                 │                 │                       │
│         ▼                 ▼                 ▼                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐             │
│  │  Service    │  │  Timeout    │  │   Dispatch      │             │
│  │   Error     │  │   Error     │  │   Failure       │             │
│  └──────┬──────┘  └──────┬──────┘  └────────┬────────┘             │
│         │                │                  │                       │
│    Error Code       Retryable           Retryable                   │
│         │                                                           │
│  ┌──────┴───────────────────────────────────────────────────┐      │
│  │                                                           │      │
│  │  Retryable:                                               │      │
│  │  • ProvisionedThroughputExceededException                │      │
│  │  • ThrottlingException                                    │      │
│  │  • InternalServerError                                    │      │
│  │  • ServiceUnavailable                                     │      │
│  │  • TransactionConflictException                          │      │
│  │                                                           │      │
│  │  Non-Retryable:                                           │      │
│  │  • ConditionalCheckFailedException                       │      │
│  │  • ValidationException                                    │      │
│  │  • ResourceNotFoundException                             │      │
│  │  • AccessDeniedException                                 │      │
│  │  • ItemCollectionSizeLimitExceededException             │      │
│  │                                                           │      │
│  └───────────────────────────────────────────────────────────┘      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 7. Authentication Architecture

### 7.1 Credential Resolution

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Credential Resolution Chain                       │
└─────────────────────────────────────────────────────────────────────┘

                    ┌───────────────────┐
                    │  Config Specified │
                    └─────────┬─────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│   Static      │     │   IAM Role    │     │  Environment  │
│  Credentials  │     │  Assumption   │     │   (Default)   │
└───────┬───────┘     └───────┬───────┘     └───────┬───────┘
        │                     │                     │
        │                     │                     ▼
        │                     │           ┌───────────────────┐
        │                     │           │  AWS Default      │
        │                     │           │  Provider Chain:  │
        │                     │           │  1. Env vars      │
        │                     │           │  2. Shared config │
        │                     │           │  3. Web identity  │
        │                     │           │  4. ECS/EC2 role  │
        │                     │           └─────────┬─────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │   AWS Credentials │
                    └───────────────────┘
```

### 7.2 IRSA Flow (EKS)

```
┌─────────────────────────────────────────────────────────────────────┐
│                    IRSA Authentication Flow                          │
└─────────────────────────────────────────────────────────────────────┘

  EKS Pod                    AWS STS                    DynamoDB
     │                          │                          │
     │  Service Account         │                          │
     │  with IAM Role ARN       │                          │
     │                          │                          │
     │  Read JWT from           │                          │
     │  /var/run/secrets/...    │                          │
     │                          │                          │
     │  AssumeRoleWithWebIdentity                          │
     │─────────────────────────►│                          │
     │                          │                          │
     │  Temporary Credentials   │                          │
     │◄─────────────────────────│                          │
     │                          │                          │
     │  DynamoDB Request with                              │
     │  SigV4 Signed Headers                               │
     │─────────────────────────────────────────────────────►
     │                                                      │
     │◄─────────────────────────────────────────────────────
     │                          │                          │
```

---

## 8. Observability Architecture

### 8.1 Telemetry Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Observability Pipeline                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────┐                                                    │
│  │  Operation  │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                            │
│         ▼                                                            │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │                  Instrumentation                         │        │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────────────┐   │        │
│  │  │  Tracing  │  │  Metrics  │  │     Logging       │   │        │
│  │  │  (spans)  │  │ (counters)│  │  (structured)     │   │        │
│  │  └─────┬─────┘  └─────┬─────┘  └─────────┬─────────┘   │        │
│  └────────┼──────────────┼──────────────────┼──────────────┘        │
│           │              │                  │                        │
│           ▼              ▼                  ▼                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐              │
│  │  X-Ray /    │  │ CloudWatch  │  │  CloudWatch     │              │
│  │  Jaeger     │  │   Metrics   │  │    Logs         │              │
│  └─────────────┘  └─────────────┘  └─────────────────┘              │
│                                                                      │
│  Span Attributes:                                                    │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  db.system          = "dynamodb"                        │        │
│  │  db.operation       = "GetItem"                         │        │
│  │  aws.dynamodb.table = "my-table"                        │        │
│  │  aws.dynamodb.consumed_capacity = 0.5                   │        │
│  │  aws.region         = "us-east-1"                       │        │
│  └─────────────────────────────────────────────────────────┘        │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 9. Simulation Architecture

### 9.1 Mock Layer

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Simulation Architecture                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │                DynamoDbProvider (trait)                  │        │
│  └─────────────────────────┬───────────────────────────────┘        │
│                            │                                         │
│         ┌──────────────────┼──────────────────┐                     │
│         │                  │                  │                     │
│         ▼                  ▼                  ▼                     │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────────┐           │
│  │    Live     │   │    Mock     │   │    Recording    │           │
│  │  Provider   │   │  Provider   │   │    Provider     │           │
│  └──────┬──────┘   └──────┬──────┘   └────────┬────────┘           │
│         │                 │                   │                     │
│         │                 ▼                   ▼                     │
│         │          ┌─────────────┐     ┌─────────────┐              │
│         │          │  In-Memory  │     │   Cassette  │              │
│         │          │   Tables    │     │    Files    │              │
│         │          └─────────────┘     └─────────────┘              │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │   AWS SDK   │                                                    │
│  │  DynamoDB   │                                                    │
│  └─────────────┘                                                    │
│                                                                      │
│  Mock Table Structure:                                               │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  MockTable {                                            │        │
│  │    name: String,                                        │        │
│  │    pk_name: String,                                     │        │
│  │    sk_name: Option<String>,                             │        │
│  │    items: Vec<HashMap<String, AttributeValue>>,         │        │
│  │    gsis: HashMap<String, GsiConfig>,                    │        │
│  │  }                                                      │        │
│  └─────────────────────────────────────────────────────────┘        │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 10. TypeScript Architecture

### 10.1 TypeScript Module Structure

```
┌─────────────────────────────────────────────────────────────────────┐
│                TypeScript Implementation                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │                   DynamoDbClient                         │        │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌─────────┐ │        │
│  │  │ table()   │ │transact() │ │ batch()   │ │ scan()  │ │        │
│  │  └───────────┘ └───────────┘ └───────────┘ └─────────┘ │        │
│  └─────────────────────────────────────────────────────────┘        │
│                                                                      │
│  Driver: @aws-sdk/client-dynamodb                                    │
│         @aws-sdk/lib-dynamodb (Document Client)                      │
│  Types: Zod schemas for item validation                              │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────┐        │
│  │  // Usage example                                        │        │
│  │  const table = client.table<User>('Users');             │        │
│  │  const user = await table.get({ PK: 'USER#123' });      │        │
│  │  await table.put({ PK: 'USER#124', name: 'Alice' });    │        │
│  │                                                          │        │
│  │  // Query with builder                                   │        │
│  │  const orders = await table.query()                     │        │
│  │    .partitionKey('USER#123')                            │        │
│  │    .sortKeyBeginsWith('ORDER#')                         │        │
│  │    .execute();                                          │        │
│  └─────────────────────────────────────────────────────────┘        │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | 2025-12-13 | SPARC Generator | Initial Architecture |

---

**Next Phase:** Refinement - Edge cases, hot partition handling, conditional expression patterns, and advanced transaction scenarios.
